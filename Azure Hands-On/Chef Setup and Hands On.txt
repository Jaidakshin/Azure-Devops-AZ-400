# Download Chef DK
wget https://packages.chef.io/files/stable/chef-workstation/20.12.187/ubuntu/18.04/chef-workstation_20.12.187-1_amd64.deb

# Install Chef DK
sudo dpkg -i chefworkstation_0.14.16-1_amd64.deb

# Verify installation
chef -v

# Create First Cookbook
mkdir -p ~/mychef/chef-repo/cookbooks
cd ~/mychef/chef-repo/cookbooks
chef generate cookbook first_cookbook
cd first_cookbook 
cd recipes

# Now modify receipe to create http server
vim ~/chef-repo/cookbooks/first_cookbook/recipes/default.rb
package 'Install Apache' do
 case node[:platform]
  when 'redhat','centos'
   package_name 'httpd'
   action    :install
  when 'ubuntu','debian'
   package_name 'apache2'
   action :install
  end
end

file '/var/www/html/index.html' do
 content 'Welcome'
end



# Configure Server
- Visit manage.chef.io
- Create profile and create organization
- Visit Administation Tab
- Download Starter Kit in home folder

# Setup Started Kit at Workstation
cd ~
sudo apt install unzip
unzip chef-starter.zip

# Test connectivity
 cd chef-repo
 knife ssl fetch
 knife ssl check

# Upload cookbook
cd ~/chef-repo
knife cookbook upload first_cookbook

# Boostrap a node using chef workstation
- Open Node Machine and take Public IP address of it
- Open Chef Workstation
Command Syntax: knife bootstrap <nodeip> --ssh-user <node-login-id> --ssh-password <node-login-password> --node-name chef_node --sudo --use-sudo-password

Sample Command: knife bootstrap 52.188.214.253 --ssh-user atingupta2005 --ssh-password Azure@123456 --node-name chef_node --sudo --use-sudo-password


# Verify that node is added or not by visiting the Check Server - manage.chef.io

# Add cookbook to the run list of the node in manage.chef.io

# Connect to the node 
sudo chef-client

# Verify if cookbook has been applied or not
curl localhost

# Open Public IP in browser to verify
104.211.28.177


