Used to load balance the traffic to multi virtual machines
VMSS will automatically scale up and down based on demand
It can integrate with Azure LB and LB will divert traffic based on VM utilization

1. Create resource VMSS
2. Image - Windows Server 2019
3. In networking edit network interface and allow public inbound port 80 and RDP
4. Enable Load Balancer
5. Scaling: Scaling Policy: Manual, Instance Count: 1
6. Health: Enable, Enable Auto Repair Policy
7. Open VMSS resource\Instances
8. Notice that instance is marked as unhealthy as IIS is not installed
9. Create script.ps1. (Available in current folder)
10. Upload this file in storage account
11. Take URL of uploaded file
12. Use the below commands in Azure Powershell. Make sure to replace URL of the file:

$config = @{
  "fileUris" = (,"https://artifactstore4000.blob.core.windows.net/script/script.ps1");
  "commandToExecute" = "powershell -ExecutionPolicy Unrestricted -File script.ps1"
}
$set = Get-AzVmss -ResourceGroupName "newgrp1" -VMScaleSetName "demoset"
$set = Add-AzVmssExtension -VirtualMachineScaleSet $set -Name "customScript" -Publisher "Microsoft.Compute" -Type "CustomScriptExtension" -TypeHandlerVersion 1.9 -Setting $config
Update-AzVmss -ResourceGroupName "newgrp1" -Name "demoset" -VirtualMachineScaleSet $set

13. Wait for 3-4 min
14. As existing machine already spun up, we need to follow below step:
15. Open VMSS resource\Instances\Select VM and click Upgrade
16. For new instances in future, the custom script will be applied automatically
17. After few minutes, check the health status in VMSS resource\Instances
18. Take IP of LB and open in browser - <IP Address>/app.html


Automatic Repair:
1. Open LB\Inbound NAT Rules
2. Create Inbound NAT rule if not already created to connect to VM via RDP
3. RDP to <Public_IP>:5001
4. Shutdown the machine to simulate failure on VM
5. Wait for 30 min
6. Notice VMSS\Instances Status is Unhealthy
7. Open VMSS resource\Instances and refresh and notice that new VM is now launched
8. Open Public IP on browser and its working


Implementing Scaling:
1. Open VMSS\Scaling: Min:1, Max: 3
2. Click "+ Add Rule" and create the scaling rule
3. Notice that based on the rule, VMSS is scaling up and down

